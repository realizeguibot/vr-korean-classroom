<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Korean Classroom VR</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm@0.2.46/lib/index.min.js"></script>
  <link rel="stylesheet" href="css/ui.css">
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading-screen">
    <div class="loader-content">
      <h1>Korean Classroom VR</h1>
      <p id="loading-status">Loading scene...</p>
      <div class="progress-bar">
        <div id="progress-fill"></div>
      </div>
    </div>
  </div>

  <!-- Chat UI Overlay -->
  <div id="chat-ui" class="hidden">
    <div id="chat-messages"></div>
    <div id="chat-input-area">
      <button id="voice-btn" title="Hold to speak">ðŸŽ¤</button>
      <input type="text" id="chat-input" placeholder="Type or speak to the student...">
      <button id="send-btn">Send</button>
    </div>
    <div id="current-npc"></div>
  </div>

  <a-scene
    vr-mode-ui="enabled: true"
    webxr="requiredFeatures: local-floor; optionalFeatures: hand-tracking"
    renderer="antialias: true; colorManagement: true; physicallyCorrectLights: true"
    loading-screen="enabled: false"
  >
    <!-- Assets -->
    <a-assets>
      <img id="wood-texture" src="https://cdn.aframe.io/a-painter/images/floor.jpg" crossorigin="anonymous">
      <img id="wall-texture" src="https://cdn.aframe.io/a-painter/images/sky.jpg" crossorigin="anonymous">
    </a-assets>

    <!-- Classroom Environment -->
    <a-entity id="classroom">
      <!-- Floor -->
      <a-plane
        position="0 0 0"
        rotation="-90 0 0"
        width="10"
        height="8"
        color="#8B7355"
        material="roughness: 0.8"
      ></a-plane>

      <!-- Walls -->
      <!-- Front wall (with blackboard) -->
      <a-plane position="0 2 -4" width="10" height="4" color="#E8E4D9"></a-plane>
      <!-- Back wall -->
      <a-plane position="0 2 4" rotation="0 180 0" width="10" height="4" color="#E8E4D9"></a-plane>
      <!-- Left wall (with windows) -->
      <a-plane position="-5 2 0" rotation="0 90 0" width="8" height="4" color="#E8E4D9"></a-plane>
      <!-- Right wall -->
      <a-plane position="5 2 0" rotation="0 -90 0" width="8" height="4" color="#E8E4D9"></a-plane>
      <!-- Ceiling -->
      <a-plane position="0 4 0" rotation="90 0 0" width="10" height="8" color="#FFFFFF"></a-plane>

      <!-- Blackboard -->
      <a-box
        position="0 1.8 -3.95"
        width="4"
        height="1.5"
        depth="0.1"
        color="#2D5A27"
      ></a-box>
      <!-- Blackboard frame -->
      <a-box position="0 1.8 -3.9" width="4.2" height="1.7" depth="0.05" color="#8B4513"></a-box>

      <!-- Blackboard text -->
      <a-text
        value="Welcome to Class!\ní™˜ì˜í•©ë‹ˆë‹¤!"
        position="0 1.8 -3.85"
        align="center"
        color="#FFFFFF"
        width="3"
      ></a-text>

      <!-- Teacher's Desk -->
      <a-box position="0 0.4 -3" width="1.5" height="0.8" depth="0.6" color="#8B4513"></a-box>

      <!-- Windows (left wall) -->
      <a-entity id="windows">
        <a-box position="-4.95 2 -1.5" width="0.1" height="2" depth="1.5" color="#87CEEB" material="opacity: 0.5; transparent: true"></a-box>
        <a-box position="-4.95 2 1.5" width="0.1" height="2" depth="1.5" color="#87CEEB" material="opacity: 0.5; transparent: true"></a-box>
      </a-entity>

      <!-- Fluorescent Lights -->
      <a-box position="-2 3.9 0" width="0.3" height="0.1" depth="4" color="#FFFFFF" material="emissive: #FFFFFF; emissiveIntensity: 0.5"></a-box>
      <a-box position="2 3.9 0" width="0.3" height="0.1" depth="4" color="#FFFFFF" material="emissive: #FFFFFF; emissiveIntensity: 0.5"></a-box>

      <!-- Student Desks (Korean style - pairs) -->
      <!-- Row 1 -->
      <a-entity class="desk-pair" position="-2 0 -1">
        <a-box class="desk" position="0 0.35 0" width="1.2" height="0.05" depth="0.6" color="#D4A574"></a-box>
        <a-box position="-0.55 0.175 0" width="0.05" height="0.35" depth="0.5" color="#666"></a-box>
        <a-box position="0.55 0.175 0" width="0.05" height="0.35" depth="0.5" color="#666"></a-box>
      </a-entity>
      <a-entity class="desk-pair" position="2 0 -1">
        <a-box class="desk" position="0 0.35 0" width="1.2" height="0.05" depth="0.6" color="#D4A574"></a-box>
        <a-box position="-0.55 0.175 0" width="0.05" height="0.35" depth="0.5" color="#666"></a-box>
        <a-box position="0.55 0.175 0" width="0.05" height="0.35" depth="0.5" color="#666"></a-box>
      </a-entity>

      <!-- Row 2 -->
      <a-entity class="desk-pair" position="-2 0 0.5">
        <a-box class="desk" position="0 0.35 0" width="1.2" height="0.05" depth="0.6" color="#D4A574"></a-box>
        <a-box position="-0.55 0.175 0" width="0.05" height="0.35" depth="0.5" color="#666"></a-box>
        <a-box position="0.55 0.175 0" width="0.05" height="0.35" depth="0.5" color="#666"></a-box>
      </a-entity>
      <a-entity class="desk-pair" position="2 0 0.5">
        <a-box class="desk" position="0 0.35 0" width="1.2" height="0.05" depth="0.6" color="#D4A574"></a-box>
        <a-box position="-0.55 0.175 0" width="0.05" height="0.35" depth="0.5" color="#666"></a-box>
        <a-box position="0.55 0.175 0" width="0.05" height="0.35" depth="0.5" color="#666"></a-box>
      </a-entity>

      <!-- Row 3 -->
      <a-entity class="desk-pair" position="-2 0 2">
        <a-box class="desk" position="0 0.35 0" width="1.2" height="0.05" depth="0.6" color="#D4A574"></a-box>
        <a-box position="-0.55 0.175 0" width="0.05" height="0.35" depth="0.5" color="#666"></a-box>
        <a-box position="0.55 0.175 0" width="0.05" height="0.35" depth="0.5" color="#666"></a-box>
      </a-entity>
      <a-entity class="desk-pair" position="2 0 2">
        <a-box class="desk" position="0 0.35 0" width="1.2" height="0.05" depth="0.6" color="#D4A574"></a-box>
        <a-box position="-0.55 0.175 0" width="0.05" height="0.35" depth="0.5" color="#666"></a-box>
        <a-box position="0.55 0.175 0" width="0.05" height="0.35" depth="0.5" color="#666"></a-box>
      </a-entity>

      <!-- Chairs -->
      <!-- Row 1 chairs -->
      <a-entity class="chair" position="-2.3 0 -0.5">
        <a-box position="0 0.25 0" width="0.4" height="0.05" depth="0.4" color="#4169E1"></a-box>
        <a-box position="0 0.45 0.18" width="0.4" height="0.35" depth="0.05" color="#4169E1"></a-box>
      </a-entity>
      <a-entity class="chair" position="-1.7 0 -0.5">
        <a-box position="0 0.25 0" width="0.4" height="0.05" depth="0.4" color="#4169E1"></a-box>
        <a-box position="0 0.45 0.18" width="0.4" height="0.35" depth="0.05" color="#4169E1"></a-box>
      </a-entity>
      <a-entity class="chair" position="1.7 0 -0.5">
        <a-box position="0 0.25 0" width="0.4" height="0.05" depth="0.4" color="#4169E1"></a-box>
        <a-box position="0 0.45 0.18" width="0.4" height="0.35" depth="0.05" color="#4169E1"></a-box>
      </a-entity>
      <a-entity class="chair" position="2.3 0 -0.5">
        <a-box position="0 0.25 0" width="0.4" height="0.05" depth="0.4" color="#4169E1"></a-box>
        <a-box position="0 0.45 0.18" width="0.4" height="0.35" depth="0.05" color="#4169E1"></a-box>
      </a-entity>

      <!-- Row 2 chairs -->
      <a-entity class="chair" position="-2.3 0 1">
        <a-box position="0 0.25 0" width="0.4" height="0.05" depth="0.4" color="#4169E1"></a-box>
        <a-box position="0 0.45 0.18" width="0.4" height="0.35" depth="0.05" color="#4169E1"></a-box>
      </a-entity>
      <a-entity class="chair" position="-1.7 0 1">
        <a-box position="0 0.25 0" width="0.4" height="0.05" depth="0.4" color="#4169E1"></a-box>
        <a-box position="0 0.45 0.18" width="0.4" height="0.35" depth="0.05" color="#4169E1"></a-box>
      </a-entity>
      <a-entity class="chair" position="1.7 0 1">
        <a-box position="0 0.25 0" width="0.4" height="0.05" depth="0.4" color="#4169E1"></a-box>
        <a-box position="0 0.45 0.18" width="0.4" height="0.35" depth="0.05" color="#4169E1"></a-box>
      </a-entity>
      <a-entity class="chair" position="2.3 0 1">
        <a-box position="0 0.25 0" width="0.4" height="0.05" depth="0.4" color="#4169E1"></a-box>
        <a-box position="0 0.45 0.18" width="0.4" height="0.35" depth="0.05" color="#4169E1"></a-box>
      </a-entity>

      <!-- Row 3 chairs -->
      <a-entity class="chair" position="-2.3 0 2.5">
        <a-box position="0 0.25 0" width="0.4" height="0.05" depth="0.4" color="#4169E1"></a-box>
        <a-box position="0 0.45 0.18" width="0.4" height="0.35" depth="0.05" color="#4169E1"></a-box>
      </a-entity>
      <a-entity class="chair" position="-1.7 0 2.5">
        <a-box position="0 0.25 0" width="0.4" height="0.05" depth="0.4" color="#4169E1"></a-box>
        <a-box position="0 0.45 0.18" width="0.4" height="0.35" depth="0.05" color="#4169E1"></a-box>
      </a-entity>
      <a-entity class="chair" position="1.7 0 2.5">
        <a-box position="0 0.25 0" width="0.4" height="0.05" depth="0.4" color="#4169E1"></a-box>
        <a-box position="0 0.45 0.18" width="0.4" height="0.35" depth="0.05" color="#4169E1"></a-box>
      </a-entity>
      <a-entity class="chair" position="2.3 0 2.5">
        <a-box position="0 0.25 0" width="0.4" height="0.05" depth="0.4" color="#4169E1"></a-box>
        <a-box position="0 0.45 0.18" width="0.4" height="0.35" depth="0.05" color="#4169E1"></a-box>
      </a-entity>

      <!-- Korean Classroom Decorations -->
      <!-- Clock -->
      <a-circle position="3.5 3.2 -3.95" radius="0.3" color="#FFFFFF">
        <a-text value="12" position="0 0.2 0.01" align="center" color="#000" width="1"></a-text>
        <a-text value="3" position="0.2 0 0.01" align="center" color="#000" width="1"></a-text>
        <a-text value="6" position="0 -0.2 0.01" align="center" color="#000" width="1"></a-text>
        <a-text value="9" position="-0.2 0 0.01" align="center" color="#000" width="1"></a-text>
      </a-circle>

      <!-- Korean Flag -->
      <a-plane position="-3.5 3 -3.95" width="0.8" height="0.5" color="#FFFFFF">
        <a-circle position="0 0 0.01" radius="0.15" color="#C60C30"></a-circle>
      </a-plane>

      <!-- Class Schedule Board -->
      <a-plane position="3 1.5 -3.95" width="1" height="1.5" color="#FFFDD0">
        <a-text value="Class Schedule\nì‹œê°„í‘œ\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€\n1. Korean êµ­ì–´\n2. Math ìˆ˜í•™\n3. English ì˜ì–´\n4. Science ê³¼í•™" position="0 0.1 0.01" align="center" color="#333" width="1.8"></a-text>
      </a-plane>
    </a-entity>

    <!-- Student NPCs -->
    <a-entity id="npcs">
      <!-- Min-jun (Class President) - Front left -->
      <a-entity
        id="npc-minjun"
        class="npc"
        position="-2.3 0 -0.5"
        npc-controller="name: Min-jun; personality: class-president"
      >
        <a-entity class="npc-body">
          <!-- Body (sitting) -->
          <a-box position="0 0.5 0" width="0.35" height="0.4" depth="0.25" color="#1E3A5F"></a-box>
          <!-- Head -->
          <a-sphere position="0 0.85 0" radius="0.15" color="#FFDAB9"></a-sphere>
          <!-- Hair -->
          <a-sphere position="0 0.92 0" radius="0.14" color="#1A1A1A" theta-length="180"></a-sphere>
          <!-- Eyes -->
          <a-sphere position="-0.04 0.85 0.12" radius="0.02" color="#000"></a-sphere>
          <a-sphere position="0.04 0.85 0.12" radius="0.02" color="#000"></a-sphere>
        </a-entity>
        <!-- Name tag (visible in VR) -->
        <a-text value="Min-jun\në¯¼ì¤€" position="0 1.15 0" align="center" color="#333" width="2" look-at="[camera]"></a-text>
        <!-- Interaction zone -->
        <a-sphere class="interaction-zone" position="0 0.7 0" radius="1" visible="false" interaction-target="npc: minjun"></a-sphere>
      </a-entity>

      <!-- Soo-yeon (Shy, Artistic) - Window side -->
      <a-entity
        id="npc-sooyeon"
        class="npc"
        position="-2.3 0 1"
        npc-controller="name: Soo-yeon; personality: shy-artistic"
      >
        <a-entity class="npc-body">
          <!-- Body -->
          <a-box position="0 0.5 0" width="0.32" height="0.38" depth="0.22" color="#FFB6C1"></a-box>
          <!-- Head -->
          <a-sphere position="0 0.85 0" radius="0.14" color="#FFE4C4"></a-sphere>
          <!-- Hair (longer) -->
          <a-box position="0 0.85 -0.05" width="0.3" height="0.35" depth="0.15" color="#2C1810"></a-box>
          <!-- Eyes (looking away slightly) -->
          <a-sphere position="-0.06 0.85 0.11" radius="0.02" color="#000"></a-sphere>
          <a-sphere position="0.02 0.85 0.11" radius="0.02" color="#000"></a-sphere>
        </a-entity>
        <a-text value="Soo-yeon\nìˆ˜ì—°" position="0 1.15 0" align="center" color="#333" width="2" look-at="[camera]"></a-text>
        <a-sphere class="interaction-zone" position="0 0.7 0" radius="1" visible="false" interaction-target="npc: sooyeon"></a-sphere>
      </a-entity>

      <!-- Ji-hoon (Class Clown) - Back right -->
      <a-entity
        id="npc-jihoon"
        class="npc"
        position="2.3 0 1"
        npc-controller="name: Ji-hoon; personality: class-clown"
      >
        <a-entity class="npc-body">
          <!-- Body -->
          <a-box position="0 0.5 0" width="0.38" height="0.42" depth="0.25" color="#32CD32"></a-box>
          <!-- Head -->
          <a-sphere position="0 0.85 0" radius="0.16" color="#FFDAB9"></a-sphere>
          <!-- Hair (messy) -->
          <a-sphere position="0 0.95 0" radius="0.13" color="#4A3728"></a-sphere>
          <!-- Big smile -->
          <a-sphere position="-0.04 0.85 0.13" radius="0.02" color="#000"></a-sphere>
          <a-sphere position="0.04 0.85 0.13" radius="0.02" color="#000"></a-sphere>
          <a-ring position="0 0.8 0.14" radius-inner="0.03" radius-outer="0.05" color="#FF6B6B" theta-length="180" rotation="180 0 0"></a-ring>
        </a-entity>
        <a-text value="Ji-hoon\nì§€í›ˆ" position="0 1.15 0" align="center" color="#333" width="2" look-at="[camera]"></a-text>
        <a-sphere class="interaction-zone" position="0 0.7 0" radius="1" visible="false" interaction-target="npc: jihoon"></a-sphere>
      </a-entity>

      <!-- Yuna (Studious) - Front right -->
      <a-entity
        id="npc-yuna"
        class="npc"
        position="1.7 0 -0.5"
        npc-controller="name: Yuna; personality: studious"
      >
        <a-entity class="npc-body">
          <!-- Body -->
          <a-box position="0 0.5 0" width="0.3" height="0.36" depth="0.2" color="#9370DB"></a-box>
          <!-- Head -->
          <a-sphere position="0 0.85 0" radius="0.13" color="#FFE4C4"></a-sphere>
          <!-- Hair (neat ponytail) -->
          <a-sphere position="0 0.92 0" radius="0.11" color="#1A1A1A"></a-sphere>
          <a-cylinder position="0 0.85 -0.1" radius="0.03" height="0.15" color="#1A1A1A" rotation="45 0 0"></a-cylinder>
          <!-- Glasses -->
          <a-ring position="-0.04 0.86 0.12" radius-inner="0.02" radius-outer="0.025" color="#333"></a-ring>
          <a-ring position="0.04 0.86 0.12" radius-inner="0.02" radius-outer="0.025" color="#333"></a-ring>
          <!-- Eyes behind glasses -->
          <a-sphere position="-0.04 0.86 0.11" radius="0.015" color="#000"></a-sphere>
          <a-sphere position="0.04 0.86 0.11" radius="0.015" color="#000"></a-sphere>
        </a-entity>
        <!-- Notebook on desk -->
        <a-box position="0 0.38 -0.5" width="0.2" height="0.02" depth="0.25" color="#FFFFFF"></a-box>
        <a-text value="Yuna\nìœ ë‚˜" position="0 1.15 0" align="center" color="#333" width="2" look-at="[camera]"></a-text>
        <a-sphere class="interaction-zone" position="0 0.7 0" radius="1" visible="false" interaction-target="npc: yuna"></a-sphere>
      </a-entity>
    </a-entity>

    <!-- Lighting -->
    <a-light type="ambient" color="#FFF5E6" intensity="0.6"></a-light>
    <a-light type="directional" color="#FFFFFF" intensity="0.4" position="0 4 0"></a-light>
    <a-light type="point" color="#FFFAF0" intensity="0.3" position="-2 3.5 0"></a-light>
    <a-light type="point" color="#FFFAF0" intensity="0.3" position="2 3.5 0"></a-light>

    <!-- Camera Rig (for VR movement) -->
    <a-entity id="rig" position="0 0 2" movement-controls="fly: false; speed: 0.1">
      <a-entity
        id="camera"
        camera
        position="0 1.6 0"
        look-controls="pointerLockEnabled: false"
        wasd-controls="enabled: false"
      >
        <!-- Cursor for interaction -->
        <a-cursor
          fuse="false"
          raycaster="objects: .npc, .interaction-zone"
          material="color: #4CC3D9; shader: flat"
          geometry="primitive: ring; radiusInner: 0.005; radiusOuter: 0.01"
        ></a-cursor>
      </a-entity>

      <!-- VR Controllers -->
      <a-entity id="left-hand" laser-controls="hand: left" raycaster="objects: .npc, .interaction-zone"></a-entity>
      <a-entity id="right-hand" laser-controls="hand: right" raycaster="objects: .npc, .interaction-zone"></a-entity>
    </a-entity>

    <!-- Teleport points -->
    <a-entity id="teleport-points">
      <a-circle class="teleport-point" position="0 0.01 -2" rotation="-90 0 0" radius="0.3" color="#4CC3D9" material="opacity: 0.5"></a-circle>
      <a-circle class="teleport-point" position="-3 0.01 0" rotation="-90 0 0" radius="0.3" color="#4CC3D9" material="opacity: 0.5"></a-circle>
      <a-circle class="teleport-point" position="3 0.01 0" rotation="-90 0 0" radius="0.3" color="#4CC3D9" material="opacity: 0.5"></a-circle>
      <a-circle class="teleport-point" position="0 0.01 2" rotation="-90 0 0" radius="0.3" color="#4CC3D9" material="opacity: 0.5"></a-circle>
    </a-entity>

    <!-- Sky -->
    <a-sky color="#87CEEB"></a-sky>
  </a-scene>

  <!-- Scripts -->
  <script src="js/npc-system.js"></script>
  <script src="js/ai-chat.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
